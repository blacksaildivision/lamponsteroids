# Configure php.ini file
#
- name: Configure php.ini file - [PHP] section
  lineinfile:
    path: "{{ php_install_path }}/lib/php.ini"
    line: "{{ item.key }} = {{ item.value }}"
    regexp: "^;?{{ item.key }}"
    insertafter: "[PHP]"
  with_dict: "{{ php_ini_config_option_php_section }}"
  notify: restart php-fpm
  tags: [php]

- name: Configure date time
  lineinfile:
    path: "{{ php_install_path }}/lib/php.ini"
    line: "date.timezone = {{ php_date_timezone }}"
    regexp: '^;?date\.timezone'
    insertafter: "[Date]"
  notify: restart php-fpm
  tags: [php]

- name: Configure MySQL socket for PDO
  lineinfile:
    path: "{{ php_install_path }}/lib/php.ini"
    line: "pdo_mysql.default_socket = {{ php_mysql_socket }}"
    regexp: '^;?pdo_mysql\.default_socket'
    insertafter: "[Pdo_mysql]"
  notify: restart php-fpm
  tags: [php]

- name: Configure MySQL socket for MySQLi
  lineinfile:
    path: "{{ php_install_path }}/lib/php.ini"
    line: "mysqli.default_socket = {{ php_mysql_socket }}"
    regexp: '^;?mysqli\.default_socket'
    insertafter: "[MySQLi]"
  notify: restart php-fpm
  tags: [php]
