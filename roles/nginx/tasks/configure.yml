# Make sure that dedicated nginx daemon user and group exists
#
- name: Create dedicated nginx group
  group:
    name: "{{ nginx_group }}"
    state: present
  tags: [nginx]

- name: Create dedicated nginx user
  user:
    name: "{{ nginx_user }}"
    createhome: no
    group: "{{ nginx_group }}"
    state: present
    shell: /sbin/nologin
  tags: [nginx]



# Create a strong Diffie-Hellman group for Forward Secrecy
# It is used for improving SSL security
#
- name: Create Diffie-Hellman group
  openssl_dhparam:
    path: "{{ nginx_df_file_path }}"
  tags: [nginx]



# Setup nginx configuration files
#
- name: Setup Gzip and Brotli configuration
  template:
    src: compression.conf.j2
    dest: "{{ nginx_install_path }}/conf/compression.conf"
    owner: root
    group: root
    mode: 0644
  notify: restart nginx
  tags: [nginx]

- name: Setup nginx main configuration
  template:
    src: nginx.conf.j2
    dest: "{{ nginx_conf_path }}"
    owner: root
    group: root
    mode: 0644
  notify: restart nginx
  tags: [nginx]
